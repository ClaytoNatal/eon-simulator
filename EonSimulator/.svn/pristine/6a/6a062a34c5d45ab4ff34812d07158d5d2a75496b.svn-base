package br.ufpe.eonsimulator.modulation;

import org.apache.log4j.Logger;

import br.ufpe.eonsimulator.domain.Simulation;
import br.ufpe.simulator.math.MathUtils;
import br.ufpe.simulator.messages.MessageUtils;

public abstract class QAMModulationFormat implements IsModulationFormat {

	private static Logger logger = Logger.getLogger(QAMModulationFormat.class);
	private static final String QAMMODULATION_PARAMS_KEY = "modulation.requiredOSNR";

	@Override
	public double createRequiredOSNR(Simulation simulation, double bitRate) {
		double slotWidth = simulation.getSimulationParameters()
				.getConnectionSlotWidth();
		double osnr = bitRate * MathUtils.converdBToLinear(getRequiredSNRdB())
				/ (2 * slotWidth);
		logger.info(MessageUtils.createMessage(QAMMODULATION_PARAMS_KEY,
				bitRate, MathUtils.convertLinearTodB(osnr)));
		return osnr;
	}

	protected abstract int getM();

	@Override
	public int createNumberOfRequiredSlots(Simulation simulation, double bitRate) {
		return (int) Math
				.ceil((bitRate / getNSymbol())
						/ simulation.getSimulationParameters()
								.getConnectionSlotWidth());
	}

	@Override
	public double getNSymbol() {
		return MathUtils.log2(getM());
	}

}