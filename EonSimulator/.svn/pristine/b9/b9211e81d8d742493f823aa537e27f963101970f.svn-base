package br.ufpe.eonsimulator.domain;

import org.apache.log4j.Logger;

import br.ufpe.eonsimulator.routing.IsRoutingAlgorithm;
import br.ufpe.simulator.math.MathUtils;
import br.ufpe.simulator.messages.MessageUtils;
import br.ufpe.simulator.utils.ConvertUtils;

public class OSNRUtils {

	private static final String SIMULATION_OSNR_INFO = "simulation.osnr.info";

	private static Logger logger = Logger.getLogger(OSNRUtils.class);

	public static boolean isValidOSNR(Simulation simulation,
			Connection connection, Route route, double nSymbol) {

		double connectionOSNR = connection.getRequiredOSNR();
		double lastLinkOSNR = route.getOSNR();
		Route dualRoute = simulation.getTopology().getDualRoute(route);
		Path dualPath = IsRoutingAlgorithm.find(dualRoute.getPath());

		double lastDualLinkOSNR = dualPath != null ? dualPath.getOSNR()
				: dualRoute.getOSNR();
		if (logger.isInfoEnabled()) {
			logger.info(MessageUtils.createMessage(SIMULATION_OSNR_INFO,
					ConvertUtils.convertToString(MathUtils
							.convertLinearTodB(connectionOSNR)), ConvertUtils
							.convertToString(MathUtils
									.convertLinearTodB(lastLinkOSNR)),
					ConvertUtils.convertToString(MathUtils
							.convertLinearTodB(lastDualLinkOSNR))));
		}
		return lastLinkOSNR >= connectionOSNR
				&& lastDualLinkOSNR >= connectionOSNR;
	}
}
